!function(e,t){"function"==typeof define&&define.amd?define(["./Decoder","./WebGLCanvas"],t):"object"==typeof exports?module.exports=t(require("./Decoder"),require("./WebGLCanvas")):e.Player=t(e.Decoder,e.WebGLCanvas)}(this,function(e,t){"use strict";var i=e.nowValue,n=function(t){var n=this;this._config=t||{},this.render=!0,this._config.render===!1&&(this.render=!1),this.nowValue=i,this._config.workerFile=this._config.workerFile||"Decoder.js",this._config.preserveDrawingBuffer&&(this._config.contextOptions=this._config.contextOptions||{},this._config.contextOptions.preserveDrawingBuffer=!0);var a="auto";if(this._config.webgl===!0?a=!0:this._config.webgl===!1&&(a=!1),"auto"==a){a=!0;try{if(window.WebGLRenderingContext){var s=document.createElement("canvas"),r=s.getContext("webgl");r||(a=!1)}else a=!1}catch(o){a=!1}}this.webgl=a,this.webgl?(this.createCanvasObj=this.createCanvasWebGL,this.renderFrame=this.renderFrameWebGL):(this.createCanvasObj=this.createCanvasRGB,this.renderFrame=this.renderFrameRGB);var c,h,d=function(e,t,a,s){n.onPictureDecoded(e,t,a,s);i();e&&n.render&&(n.renderFrame({canvasObj:n.canvasObj,data:e,width:t,height:a}),n.onRenderFrameComplete&&n.onRenderFrameComplete({data:e,width:t,height:a,infos:s,canvasObj:n.canvasObj}))};if(this._config.size||(this._config.size={}),this._config.size.width=this._config.size.width||200,this._config.size.height=this._config.size.height||200,this._config.useWorker){var f=new Worker(this._config.workerFile);this.worker=f,f.addEventListener("message",function(e){var t=e.data;return t.consoleLog?void console.log(t.consoleLog):void d.call(n,new Uint8Array(t.buf,0,t.length),t.width,t.height,t.infos)},!1),f.postMessage({type:"Broadway.js - Worker init",options:{rgb:!a,memsize:this.memsize,reuseMemory:this._config.reuseMemory?!0:!1}}),this._config.transferMemory?this.decode=function(e,t){f.postMessage({buf:e.buffer,offset:e.byteOffset,length:e.length,info:t},[e.buffer])}:this.decode=function(e,t){var i=new Uint8Array(e.length);i.set(e,0,e.length),f.postMessage({buf:i.buffer,offset:0,length:e.length,info:t},[i.buffer])},this._config.reuseMemory&&(this.recycleMemory=function(e){f.postMessage({reuse:e.buffer},[e.buffer])})}else this.decoder=new e({rgb:!a}),this.decoder.onPictureDecoded=d,this.decode=function(e,t){n.decoder.decode(e,t)};this.render&&(this.canvasObj=this.createCanvasObj({contextOptions:this._config.contextOptions}),this.canvas=this.canvasObj.canvas),this.domNode=this.canvas,c=this._config.size.width,h=this._config.size.height};return n.prototype={onPictureDecoded:function(e,t,i,n){},recycleMemory:function(e){},createCanvasWebGL:function(e){var t=this._createBasicCanvasObj(e);return t.contextOptions=e.contextOptions,t},createCanvasRGB:function(e){var t=this._createBasicCanvasObj(e);return t},_createBasicCanvasObj:function(e){e=e||{};var t={},i=e.width;i||(i=this._config.size.width);var n=e.height;return n||(n=this._config.size.height),t.canvas=document.createElement("canvas"),t.canvas.width=i,t.canvas.height=n,t.canvas.style.backgroundColor="#0D0E1B",t},renderFrameWebGL:function(e){var i=e.canvasObj,n=e.width||i.canvas.width,a=e.height||i.canvas.height;i.canvas.width===n&&i.canvas.height===a&&i.webGLCanvas||(i.canvas.width=n,i.canvas.height=a,i.webGLCanvas=new t(i.canvas,void 0,i.contextOptions)),i.webGLCanvas.drawNextOutputPicture(n,a,null,e.data);var s=this;s.recycleMemory(e.data)},renderFrameRGB:function(e){var t=e.canvasObj,i=e.width||t.canvas.width,n=e.height||t.canvas.height;(t.canvas.width!==i||t.canvas.height!==n)&&(t.canvas.width=i,t.canvas.height=n);var a=t.ctx,s=t.imgData;a||(t.ctx=t.canvas.getContext("2d"),a=t.ctx,t.imgData=a.createImageData(i,n),s=t.imgData),s.data.set(e.data),a.putImageData(s,0,0);var r=this;r.recycleMemory(e.data)}},n});